YUI.add("search-photos-everyone-view",function(e){e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){var n,r=t.modelParams?t.modelParams.apiParams:{};return this.get("container").get("innerHTML")===""&&(n=this.templates("search-photos-everyone-view")({loading:!0}),this.setContainerHTML(n)),this.searchUrl=new e.SearchUrl(r,this.appContext),this.searchTerm=t.searchTerm,this.apiFailed=t.apiFailed,this.apiFailed?this:(r.view_all||t.searchType!==e.SearchUrl.searchTypes.UNIFIED?(this.viewAll=!0,this.searchUrl.removeAPIParam("view_all"),this.searchUrl.removeAPIParam("nsid"),this.searchUrl.removeAPIParam("user_id"),this.searchUrl.removeAPIParam("contacts"),this.viewAllLink=!1):(this.searchUrl.setAPIParam("view_all",!0),this.viewAllLink=this.searchUrl.getURL()),this.searchId=t.searchId,t.photoListConfig={modelParams:{registryName:"search-photos-lite-models",modelIdOrAttributes:t.searchId,collectionAttributeName:"photos",fetchParams:{apiParams:r}},parentName:this.name,engagementModelName:"photo-lite-models",injectPhotolistContextParams:{rapidBeaconConfig:{beaconName:"searchPhotoResultClick",itemIndexKey:"vespaRnk"}},layout:{containerPadding:{top:0,right:0,bottom:8,left:0},targetRowHeight:170,awakeBoundsToViewportSizeRatio:5}},r.view_type==="thumbs"&&(t.photoListConfig.layout.forceAspectRatio=1),this)},subviewConfig:{"photo-list-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(){return this.apiFailed}}},loadState:function(){var t=this;return this.apiFailed?e.Promise.resolve():this.appContext.getModel("search-photos-lite-models",this.searchId).then(function(n){return t.searchModel=n,t.apiParams=t.searchModel.getValue("apiParams"),e.SearchHelper.deriveScopeTitle(t.apiParams,t.appContext)}).then(function(e){t.scopeTitle=t.intlMessage(e)})},buildContainer:function(){var e={apiFailed:!1,noQuery:!1,noMatchesForQuery:!1,validResults:!1};this.apiFailed?e.apiFailed=!0:this.searchModel.getValue("totalItems")<=0?this.searchModel.getValue("emptyQuery")?e.noQuery=!0:e.noMatchesForQuery=this.buildNoMatchesFoundMessage():e.validResults=!0;var t=this.templates("search-photos-everyone-view")({searchState:e,photoListTitle:this.scopeTitle,viewAllLink:this.viewAllLink,photos:this.apiFailed?"":this.searchModel.toJSON(),photoCount:this.apiFailed?"":this.searchModel.getValue("totalItems"),"photo-list-view":this.apiFailed?"":this.subviews["photo-list-view"].get("container"),viewAll:this.viewAll});return this.setContainerHTML(t),this},activate:function(){return this},buildNoMatchesFoundMessage:function(){var t,n,r,i=this.appContext.getViewer();return n=this.searchModel.getValue("apiParams"),n.user_id?i.signedIn&&n.user_id===i.nsid?this.searchTerm?r="search.NO_MATCHES_FOR_QUERY_TERM_CONTEXT_YOUR":r="search.NO_MATCHES_FOR_QUERY_TERM_YOUR":this.searchTerm?r="search.NO_MATCHES_FOR_QUERY_TERM_CONTEXT_USER":r="search.NO_MATCHES_FOR_QUERY_TERM_USER":n.contacts?this.searchTerm?r="search.NO_MATCHES_FOR_QUERY_TERM_CONTEXT_CONTACTS":r="search.NO_MATCHES_FOR_QUERY_TERM_CONTACTS":n.group_id?this.searchTerm?r="search.NO_MATCHES_FOR_QUERY_TERM_CONTEXT_GROUP":r="search.NO_MATCHES_FOR_QUERY_TERM_GROUP":this.searchTerm?r="search.NO_MATCHES_FOR_QUERY_TERM_WITH_SETTINGS":r="search.NO_MATCHES_FOR_QUERY",this.searchTerm?t=this.intlMessage({intlName:r,searchTerm:e.flutil.unescape(this.searchTerm)}):t=this.intlMessage({intlName:r}),{noMatchesText:t}}})},"@VERSION@",{requires:["flickr-view","photo-list-view","flickr-promise","search-url","hermes-template-search-photos-everyone-view","search-helper","flutil","search-photos-lite-models"],langBundles:["search"]});
YUI.add("search-counts-models",function(e){function t(e){t.superclass.constructor.call(this,e)}function n(t){return t=e.AttributeHelpers.coerceInteger(t),t}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-search-counts"].run(t,this.appContext)}},attributes:{everyonePhotos:{setter:n,defaultValue:0},youPhotos:{setter:n,defaultValue:0},sets:{setter:n,defaultValue:0},yourGroups:{setter:n,defaultValue:0},groups:{setter:n,defaultValue:0},contactsPhotos:{setter:n,defaultValue:0},people:{setter:n,defaultValue:0},peopleFollowed:{setter:n,defaultValue:0},apiParams:{writeOnce:"initOnly"},emptyQuery:{defaultValue:!1}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-search-counts-fetcher","search-helper"]});
YUI.add("flickr-search-counts-fetcher",function(e){"use strict";function t(t){var n={id:t.id,emptyQuery:!1},r=e.merge(t.apiParams);return YUI.Env.isServer&&e.SearchHelper.unescapeParameters(r),e.SearchHelper.isParameterlessSearch(r)?(n.emptyQuery=!0,n):(r.counts_only=1,n.everyonePhotos=e.merge(r),delete n.everyonePhotos.user_id,delete n.everyonePhotos.contacts,n.contactsPhotos=e.merge(n.everyonePhotos),n.contactsPhotos.contacts="true",n.youPhotos=e.clone(r),!r.user_id&&t.viewerNsid&&(n.youPhotos.user_id=t.viewerNsid),n.sets={text:r.text,user_id:t.viewerNsid,counts_only:1},r.sort&&(n.sets.sort=r.sort),n.yourGroups=e.merge(n.sets),r.filter_inactive_groups&&(n.yourGroups.filter_inactive_groups=r.filter_inactive_groups),n.groups=e.merge(n.yourGroups),delete n.groups.user_id,n.people=e.merge(n.groups),n.peopleFollowed=e.merge(n.yourGroups),n.peopleFollowed.username=n.people.text,n.people.username=n.people.text,delete n.people.text,delete n.peopleFollowed.text,n)}function n(t,n){var r={id:n.id||e.SearchUrl.EMPTY_SEARCH_ID,everyonePhotos:0,youPhotos:0,sets:0,yourGroups:0,groups:0,contactsPhotos:0,people:0,peopleFollowed:0,apiParams:{},emptyQuery:n.emptyQuery},i,s,o=t[0],u=t[1];n.id&&n.id!==e.SearchUrl.EMPTY_SEARCH_ID&&(r.apiParams=e.QueryString.parse(n.id));for(i in o)o[i]?o[i].photos?s=parseInt(o[i].photos.count,0):o[i].people?s=parseInt(o[i].people.count,0):o[i].groups?s=parseInt(o[i].groups.count,0):o[i].photosets&&(s=parseInt(o[i].photosets.count,0)):s=0,isNaN(s)?r[i]=0:r[i]=s;return u.exists(n.id)||u.add(r),o}function r(t,n){var r=n.length,i={};return new e.Promise(function(e,s){for(var o=0;o<n.length;o++)t.callAPI(n[o].method,n[o].data).then(function(){var t=n[o].id;return function(n){r--,i[t]=n,r<=0&&e(i)}}(),function(t){r--,r<=0&&e(i)})})}function i(t,n){var i=this,s=[];return t=t.emptyQuery?{}:this._processParams(t),t.emptyQuery||(s.push({method:"flickr.photos.search",data:t.everyonePhotos,id:"everyonePhotos"}),s.push({method:"flickr.photos.search",data:t.youPhotos,id:"youPhotos"}),s.push({method:"flickr.photosets.search",data:t.sets,id:"sets"}),s.push({method:"flickr.groups.search",data:t.yourGroups,id:"yourGroups"}),s.push({method:"flickr.groups.search",data:t.groups,id:"groups"}),s.push({method:"flickr.photos.search",data:t.contactsPhotos,id:"contactsPhotos"}),s.push({method:"flickr.people.search",data:t.people,id:"people"}),s.push({method:"flickr.people.search",data:t.peopleFollowed,id:"peopleFollowed"})),e.Promise.all([t.emptyQuery?e.Promise.resolve({}):r(n,s),n.getModelRegistry("search-counts-models")]).then(function(e){return i._processResponse(e,t)},function(e){throw n[e.fatal?"error":"debug"]("[flickr-search-counts-fetcher] failed getting or processing API response:",e),e})}e.namespace("ModelFetchers")["flickr-search-counts"]={run:i,_processResponse:n,_processParams:t}},"@VERSION@",{requires:["flickr-promise","search-helper","search-url","querystring-parse-simple"],optional:["search-counts-models"]});
YUI.add("search-photos-unified-page-view",function(e){e.namespace("Views")[this.name]=e.Base.create("search-photos-unified-page-view",e.FlickrView,[],{langBundles:this.details.langBundles,advancedPanelVisible:!1,initializer:function(t){this.apiParams=t.modelParams?t.modelParams.apiParams:{},this.searchUrl=new e.SearchUrl(this.apiParams,this.appContext),this.searchTerm=t.searchTerm,this.apiFailed=t.apiFailed;if(this.apiFailed)return this.showYours=!1,this.showContacts=!1,this.showAlbums=!1,this.showEveryones=!0,this;this.searchId=t.searchId,this.advancedPanelVisible=parseInt(this.apiParams.advanced)===1?!0:!1;var n=this.name.replace(/-/g,"_");YUI.Env.isServer&&e.config.flickr.paft_metrics_samples&&e.config.flickr.paft_metrics_samples[n]&&(t.paft=!0),this.showYours=!0,this.showContacts=!0,this.showAlbums=!0,this.showEveryones=!0,t.searchType===e.SearchUrl.searchTypes.GENERAL&&(this.showYours=!1,this.showContacts=!1,this.showAlbums=!1,this.showEveryones=!0);if(this.apiParams.user_id||this.apiParams.contacts||this.apiParams.view_all)this.showContacts=!1,this.showAlbums=!1,this.showYours=!1;return this.apiParams.album_search&&(this.showAlbums=!0),this.apiParams.view_all||this.searchUrl.removeAPIParam("view_all"),this.apiParams.view_all&&this.apiParams.album_search?this.showEveryones=!1:this.searchUrl.removeAPIParam("album_search"),this},subviewConfig:{"global-nav-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,isSearchResults:!0},"search-subnav-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,selectedTabKey:"photos",disabled:function(){return this.apiFailed}},"search-photos-yours-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(){return!this.showYours}},"search-photos-contacts-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(){return!this.showContacts}},"search-photos-albums-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(){return!this.showAlbums}},"search-advanced-panel-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,disabled:function(){return this.apiFailed}},"search-photos-everyone-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(){return!this.showEveryones}},"footer-full-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},loadState:function(){var t=this;return this.apiFailed?(e.SearchHelper.addParamDefaults(this.apiParams),e.Promise.resolve()):e.FlickrPromise({searchModel:this.appContext.getModel("search-photos-lite-models",this.searchId),countsModel:this.appContext.getModel("search-counts-models",this.searchId)}).then(function(e){var n=e.countsModel;t.searchModel=e.searchModel,t.countsModel=e.countsModel,n.getValue("youPhotos")<1&&(t.showYours=!1),n.getValue("sets")<1&&(t.showAlbums=!1),n.getValue("contactsPhotos")<1&&(t.showContacts=!1),t.apiParams=t.searchModel.getValue("apiParams")})},buildContainer:function(){var e="",t=this,n;return this.searchUrl.setAPIParam("view_all",!0),this.searchModel&&this.searchModel.getValue("emptyQuery")&&(this.showYours=!1,this.showContacts=!1,this.showAlbums=!1,this.showEveryones=!0),n={"global-nav-view":this.subviews["global-nav-view"].get("container"),"search-advanced-panel":this.apiFailed?"":this.subviews["search-advanced-panel-view"].get("container"),"search-subnav-view":this.apiFailed?"":this.subviews["search-subnav-view"].get("container"),showAlbums:this.showAlbums,showEveryones:this.showEveryones,showContacts:this.showContacts,showYours:this.showYours,"footer-full-view":e,advancedPanelVisible:this.advancedPanelVisible},["search-photos-yours-view","search-photos-albums-view","search-photos-contacts-view","search-photos-everyone-view"].forEach(function(e){t.subviews[e]&&(n[e]=t.subviews[e].get("container"))}),this.setContainerHTML(this.templates("search-photos-unified-page-view")(n)),this},activate:function(){return e.later(100,this,function(){e.use("photo-page-scrappy-view")}),this},buildNoMatchesFoundMessage:function(){var t,n,r,i=this.appContext.getViewer();return n=this.searchModel.getValue("apiParams"),n.user_id?i.signedIn&&n.user_id===i.nsid?this.searchTerm?r="search.NO_MATCHES_FOR_QUERY_TERM_CONTEXT_YOUR":r="search.NO_MATCHES_FOR_QUERY_TERM_YOUR":this.searchTerm?r="search.NO_MATCHES_FOR_QUERY_TERM_CONTEXT_USER":r="search.NO_MATCHES_FOR_QUERY_TERM_USER":n.contacts?this.searchTerm?r="search.NO_MATCHES_FOR_QUERY_TERM_CONTEXT_CONTACTS":r="search.NO_MATCHES_FOR_QUERY_TERM_CONTACTS":n.group_id?this.searchTerm?r="search.NO_MATCHES_FOR_QUERY_TERM_CONTEXT_GROUP":r="search.NO_MATCHES_FOR_QUERY_TERM_GROUP":this.searchTerm?r="search.NO_MATCHES_FOR_QUERY_TERM":r="search.NO_MATCHES_FOR_QUERY",this.searchTerm?t=this.intlMessage({intlName:r,searchTerm:e.flutil.unescape(this.searchTerm)}):t=this.intlMessage({intlName:r}),{noMatchesText:t}},onSubviewEvent:function(e,t){t&&t[2]&&t[2]==="toggle-advanced"?this.toggleAdvancedSearch():t&&t[0]==="dirty"&&this.get("container").addClass("dirty")},toggleAdvancedSearch:function(){function i(){t.removeClass("collapsed"),t.getDOMNode().removeEventListener("transitionend",i)}var t=e.one(".advanced-search-wrapper"),n,r;this.advancedPanelVisible?(t.setStyle("height","0px"),t.addClass("collapsed"),this.advancedPanelVisible=!1,this.subviews["search-advanced-panel-view"].fire("parentViewEvent","toggle-advanced")):(r=this.subviews["search-advanced-panel-view"].get("container").get("offsetHeight"),t.setStyle("height",r+"px"),n=t.getDOMNode().addEventListener("transitionend",i),this.advancedPanelVisible=!0)}},{ATTRS:{spaceid:{value:792600534}}})},"@VERSION@",{requires:["flutil","flickr-view","flickr-promise","search-helper","hermes-template-search-photos-unified-page-view","search-subnav-view","search-photos-albums-view","search-photos-yours-view","search-photos-contacts-view","search-advanced-panel-view","search-photos-everyone-view","search-url","search-unified-css","flickrui-css","footer-full-view","querystring-stringify-simple","search-counts-models","search-photos-lite-models"
],langBundles:["search"]});
YUI.add("search-photos-route",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Routes[this.name]=t,e.extend(t,e.FlickrRoute,{langBundles:this.details.langBundles,run:function(e){return this.appContext.flipper.isFlipped("reboot-unified-search")?this.runSearchUnified(e):this.runSearchStandard(e)},runSearchUnified:function(t){var n={},r,i=this,s,o=!0,u=!1,a=!0,f=e.SearchUrl.searchTypes.GENERAL;return n.apiParams=this.processRequest(t),n.id=e.SearchHelper.generateQueryString(n.apiParams)||e.guid(),n.apiParams.text&&(s=n.apiParams.text),t.probableUser?n.viewerNsid=t.probableUser:n.viewerNsid=this.appContext.getViewer().nsid,r={perPage:25},e.FlickrPromise({counts:this.appContext.getModel("search-counts-models",n,r),everyone:this.appContext.getModel("search-photos-lite-models",n,r)}).then(function(t){var r=i.appContext.getViewer(),l=t.everyone;return r.signedIn&&!n.apiParams.view_all&&(f=e.SearchUrl.searchTypes.UNIFIED,o=!1),r.signedIn&&n.apiParams.user_id===r.nsid&&(f=e.SearchUrl.searchTypes.YOURS,o=!0),r.signedIn&&n.apiParams.contacts&&(f=e.SearchUrl.searchTypes.CONTACTS,o=!0),n.apiParams.user_id&&(f=e.SearchUrl.searchTypes.NSID,o=!0),n.apiParams.album_search&&n.apiParams.view_all&&(a=!1,o=!1),o&&(u=!0),e.Promise.resolve({view:"search-photos-unified-page-view",params:{searchId:YUI.Env.isServer?l.id:l.id,searchTerm:s,searchType:f,modelParams:n,showTools:o,showAdvanced:a,showSort:u},layout:"scrolling",fluid:!0})},function(t){return i.appContext.warn("search-photos-route",t.message),e.Promise.resolve({view:"search-photos-unified-page-view",params:{searchTerm:s,apiFailed:!0},fluid:!0})})},runSearchStandard:function(t){var n={},r,i=this,s=i.intlMessage({intlName:"search.FLICKR_SEARCH"}),o=": ",u,a,f=this.appContext.flipper.isFlipped("enable-hover-account-menu")&&this.appContext.flipper.isFlipped("rebootify-group-discussions-list"),l;return n.apiParams=this.processRequest(t),n.id=e.SearchHelper.generateQueryString(n.apiParams)||e.guid(),n.apiParams.text?(u=n.apiParams.text,a=o+n.apiParams.text):n.apiParams.tags&&(a=o+n.apiParams.tags),l=e.flutil.unescape(a),r={perPage:e.SearchHelper.PREFETCH_PAGE_SIZE},this.appContext.getModel("search-photos-models",n,r).then(function(t){return e.Promise.resolve({view:"search-photos-page-view",params:{searchId:YUI.Env.isServer?t.id:t.id,searchTerm:u},title:t.getValue("emptyQuery")||!l?s:s+l,layout:"scrolling",fluid:f})},function(t){return i.appContext.warn("search-photos-route",t.message),e.Promise.resolve({view:"search-photos-page-view",params:{searchTerm:u,apiFailed:!0},title:l?s+l:s,fluid:f})})},processRequest:function(t){var n={};return n=e.merge(t.query,e.SearchHelper.mapRouteParamsToAPI(t.params)),n=e.SearchHelper.mapClassicSearchToAPI(n,this.appContext),e.SearchHelper.addParamDefaults(n),YUI.Env.isServer&&e.SearchHelper.unescapeParameters(n),n}}),e.mix(t.prototype,e.Localizable)},"@VERSION@",{requires:["flutil","flickr-route","flickr-promise","search-helper","querystring-stringify-simple","localizable","search-photos-models","search-photos-lite-models","url","search-url","search-photos-page-view","search-photos-unified-page-view"],langBundles:["search"]});
