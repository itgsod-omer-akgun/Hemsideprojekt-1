YUI.add("flickr-products-books-editBook-updater",function(e){"use strict";function t(t,n){var r={};return r.book_id=t.bookId,r.title=t.title,e.Promise.all([n.callAPI("flickr.products.books.editBook",r),n.getModelRegistry("book-models")]).then(function(e){return self._processResponse(e,t)},function(e){throw n[e.fatal?"error":"debug"]("[flickr-products-books-editBook-updater] failed getting or processing API response: ",e),e})}e.namespace("ModelUpdaters")["flickr-products-books-editBook"]={run:t}},"@VERSION@",{requires:["flickr-promise","api-helper","api-products-books-helper"],optional:["page-models","book-models"]});
YUI.add("flickr-products-books-creator",function(e){"use strict";function t(t){var n={};return t=t||{},n=t,n.cacheBust=Date.now(),n.extras=e.APIHelper.request.getRebootPhotoExtras(),n}function n(t,n){var r,i;return r={pageModelRegistry:t.pageModelRegistry,bookModelRegistry:t.bookModelRegistry,pagePhotoModelRegistry:t.pagePhotoModelRegistry,photoModelRegistry:t.photoModelRegistry,personRegistry:t.personRegistry,photoEngagementRegistry:t.photoEngagementRegistry,photoStatsRegistry:t.photoStatsRegistry},i=e.ProductsAPIHelper.parseBook(t.response.book,r),i}function r(t,n){var r=this;return(new e.FlickrPromise({response:n.callAPI("flickr.products.books.create",this._processParams(t)),pageModelRegistry:n.getModelRegistry("page-models"),bookModelRegistry:n.getModelRegistry("book-models"),pagePhotoModelRegistry:n.getModelRegistry("book-page-photo-models"),photoModelRegistry:n.getModelRegistry("photo-models"),personRegistry:n.getModelRegistry("person-models"),photoEngagementRegistry:n.getModelRegistry("photo-engagement-models"),photoStatsRegistry:n.getModelRegistry("photo-stats-models")})).then(function(e){return r._processResponse(e,t)},function(e){throw n[e.fatal?"error":"debug"]("[flickr-products-books-creator] failed getting or processing API response:",e),e})}e.namespace("ModelCreators")["flickr-products-books-creator"]={run:r,_processParams:t,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper","products-api-helper"],optional:["page-models","book-models","book-page-photo-models","photo-models","person-models","photo-engagement-models"]});
YUI.add("book-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-products-books"].run(t,this.appContext)},update:function(t,n){return"title"in n?e.ModelUpdaters["flickr-products-books-editBook"].run({bookId:t,title:n.title.newVal},this.appContext):e.ModelUpdaters["flickr-products-books-updateBook"].run({bookId:t},this.appContext)},create:function(t){return e.ModelCreators["flickr-products-books-creator"].run(t,this.appContext)}},movePage:function(e,t,n,r){var i,s,o,u;return i=this.getValue(e,"pageOrder"),s=i.length,t<s&&n<s&&(r?u=i.splice(t,2):u=i.splice(t,1)[0],o=[n,0].concat(u),Array.prototype.splice.apply(i,o)),this.setValue(e,"pageOrder",i),i},addPage:function(e,t,n){var r,i;return r=this.getValue(e,"pageOrder"),i=r.length,n<=i&&r.splice(n+1,0,t),this.setValue(e,"pageOrder",r),r},removePage:function(e,t){var n,r,i,s;return n=this.getValue(e,"pageOrder"),s=n.length,r=n.indexOf(t),r<s&&(i=n.splice(r,1),this.setValue(e,"pageOrder",n)),n},attributes:{title:{},owner:{},pageOrder:{},coverPage:{isModel:!0},totalPhotos:{},price:{},lastPageViewed:{},created:{getter:function(e){return parseInt(e,10)}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-products-books-fetcher","flickr-products-books-updateBook-updater","flickr-products-books-editBook-updater","flickr-products-books-creator"]});
YUI.add("flickr-products-books-addPage-creator",function(e){"use strict";function t(t){var n={book_id:t.bookId};return t.photoIds&&(n.photo_ids=t.photoIds.join(","),n.extras=e.APIHelper.request.getRebootPhotoExtras()),e.Lang.isNumber(t.templateId)&&(n.template_id=t.templateId),t.backgroundColor&&(n.background_color=t.backgroundColor),n}function n(t,n,r){var i=t[0],s=t[1],o=t[2],u=t[3],a=t[4],f=t[5],l=t[6],c=[],h,p=i.page,d,v;return p.photo&&e.Array(p.photo).forEach(function(t){var r,i,s,f,h;h=p.id+"_"+t.position,r={id:h,bookId:n.bookId,position:t.position,cropX:t.cropX/100,cropY:t.cropY/100,cropW:t.cropW/100,cropH:t.cropH/100,invalidForPrintReason:t.invalidForPrintReason,isInvalidForPrint:t.isInvalidForPrint},i=e.APIHelper.response.parsePhoto(t),s=i.owner,f=i.engagement,d=s.id,a.exists(d)?(delete s.id,a.setValues(d,s)):a.add(s),i.owner=a.proxy(d),d=f.id,l.exists(d)?(delete f.id,l.setValues(d,f)):l.add(f),i.engagement=l.proxy(d),d=i.id,u.exists(d)?(delete i.id,u.setValues(d,i)):u.add(i),r.photo=u.proxy(d),d=r.id,o.exists(d)?(delete r.id,o.setValues(d,r)):o.add(r),c.push(o.proxy(d))}),v=e.APIHelper.response.parsePage(p),v.pagePhotos=c,v.bookId=n.bookId,d=v.id,s.exists(d)?(delete v.id,s.setValues(d,v),h=s.proxy(d)):h=s.add(v),f.proxy(n.bookId).getValue("pages").appendToList(h),h}function r(t,n){var r=this;return e.Promise.all([n.callAPI("flickr.products.books.addPage",this._processParams(t)),n.getModelRegistry("page-models"),n.getModelRegistry("book-page-photo-models"),n.getModelRegistry("photo-models"),n.getModelRegistry("person-models"),n.getModelRegistry("book-models"),n.getModelRegistry("photo-engagement-models")]).then(function(e){return r._processResponse(e,t,n)},function(e){throw n.error("[flickr-products-books-addPage-creator] failed getting or processing API response:",e),e})}e.namespace("ModelCreators")["flickr-products-books-addPage"]={run:r,_processParams:t,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["page-models","book-models","book-page-photo-models","photo-models","person-models","photo-engagement-models"]});
YUI.add("flickr-products-books-removePage-deletor",function(e){"use strict";function t(e,t){var n=e[1],r=e[0],i=n.book,s;i&&(s={id:i.id,price:i.price},r.exists(s.id)&&r.setValues(s.id,{price:s.price}))}function n(t,n,r){var i={},s=this;return i.page_id=t,i.book_id=n,e.Promise.all([r.getModelRegistry("book-models"),r.callAPI("flickr.products.books.removePage",i)]).then(function(e){return s._processResponse(e)},function(e){throw r[e.fatal?"error":"debug"]("[flickr-products-books-removePage-deletor] failed getting or processing API response: ",e),e})}e.namespace("ModelDeletors")["flickr-products-books-removePage"]={run:n,_processResponse:t}},"@VERSION@",{requires:[],optional:[]});
YUI.add("page-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-products-books-getPage"].run(t,this.appContext)},update:function(t,n){return e.ModelUpdaters["flickr-products-books-updateBook"].run({bookId:this.getValue(t,"bookId")},this.appContext)},create:function(t){return e.ModelCreators["flickr-products-books-addPage"].run(t,this.appContext)},"delete":function(t){return e.ModelDeletors["flickr-products-books-removePage"].run(t,this.getValue(t,"bookId"),this.appContext)}},forceUpdate:function(t){return e.ModelUpdaters["flickr-products-books-updateBook"].run({bookId:this.getValue(t,"bookId")},this.appContext)},attributes:{bookId:{getter:function(e){return parseInt(e,10)},validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},backgroundColor:{defaultValue:"255,255,255"},pageNumber:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},template:{getter:function(e){return parseInt(e,10)},validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},countPhotos:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},pagePhotos:{isListProxy:!0}}})},"@VERSION@",{requires:["flickr-products-books-editPage-updater","flickr-products-books-getPage-fetcher","flickr-products-books-addPage-creator","flickr-products-books-removePage-deletor","flickr-model-registry","flickr-promise"]});
YUI.add("flickr-products-books-fetcher",function(e){"use strict";function t(t){t.page=t.page||1,t.perPage=t.perPage||100;var n={book_id:t.id,extras:e.APIHelper.request.getRebootPhotoExtras()};return n}function n(t,n){var r,i;return r={pageModelRegistry:t.pageModelRegistry,bookModelRegistry:t.bookModelRegistry,pagePhotoModelRegistry:t.pagePhotoModelRegistry,photoModelRegistry:t.photoModelRegistry,personRegistry:t.personRegistry,photoEngagementRegistry:t.photoEngagementRegistry,photoStatsRegistry:t.photoStatsRegistry},i=e.ProductsAPIHelper.parseBook(t.response.book,r),i}function r(t,n){var r=this;return(new e.FlickrPromise({response:n.callAPI("flickr.products.books.getBook",this._processParams(t)),pageModelRegistry:n.getModelRegistry("page-models"),bookModelRegistry:n.getModelRegistry("book-models"),pagePhotoModelRegistry:n.getModelRegistry("book-page-photo-models"),photoModelRegistry:n.getModelRegistry("photo-models"),personRegistry:n.getModelRegistry("person-models"),photoEngagementRegistry:n.getModelRegistry("photo-engagement-models"),photoStatsRegistry:n.getModelRegistry("photo-stats-models")})).then(function(e){return r._processResponse(e,t)},function(e){throw n[e.fatal?"error":"debug"]("[flickr-products-books-fetcher] failed getting or processing API response:",e),e})}e.namespace("ModelFetchers")["flickr-products-books"]={run:r,_processResponse:n,_processParams:t}},"@VERSION@",{requires:["flickr-promise","api-helper","products-api-helper"],optional:["page-models","book-models","book-page-photo-models","photo-models","person-models","photo-engagement-models"]});
YUI.add("basic-book-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{title:{},owner:{},coverPhoto:{isModel:!0},coverPhotoDeleted:{defaultFn:function(){return!1}},cropW:{setter:function(e){return Math.abs(e)||0},getter:function(e){return parseFloat(e,10)||0},defaultFn:function(){return 0},defaultValue:0},cropH:{setter:function(e){return Math.abs(e)||0},getter:function(e){return parseFloat(e,10)||0},defaultFn:function(){return 0},defaultValue:0},cropX:{setter:function(e){return Math.abs(e)||0},getter:function(e){return parseFloat(e,10)||0},defaultFn:function(){return 0},defaultValue:0},cropY:{setter:function(e){return Math.abs(e)||0},getter:function(e){return parseFloat(e,10)||0},defaultFn:function(){return 0},defaultValue:0},totalPages:{},created:{getter:function(e){return parseInt(e,10)}},updated:{getter:function(e){return parseInt(e,10)}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-products-books-fetcher","flickr-products-books-updateBook-updater","flickr-products-books-editBook-updater"]});
YUI.add("flickr-creations-fetcher",function(e){"use strict";function t(t){var n={extras:e.APIHelper.request.getRebootPhotoExtras()};return n}function n(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=[],p=[],d=[];return r&&r.stat==="ok"&&(h=Object.keys(r.wallart_ids).map(function(e){return r.wallart_ids[e]}),e.Array.each(h,function(t,r){if(t.photoSource===2)return;var i,s,u,h,d=[],v=!1,m,g,y,b={};s=a.exists(n.id)?a.proxy(n.id):a.add({id:t.owner}),t.photo.id?(b={photos:[t.photo],personModelRegistry:a,photoModelRegistry:f,photoEngagementModelRegistry:l,photoStatsModelRegistry:c},t.photo.ownerId&&(b.ownerID=t.photo.ownerId),u=e.APIHelper.response.parsePhotos(b)[0]):v=!0,t.orders&&typeof t.orders=="object"&&(h=Object.keys(t.orders).map(function(e){return t.orders[e]}),e.Array.each(h,function(e){d.push({orderId:e.orderId,orderStatus:e.order.statusOrder,dateCreate:e.dateCreate,dateUpdate:e.dateUpdate})})),t.skuId.substr(-2)==="CC"?(m=t.skuId.slice(0,-3),g=!0):t.skuId.substr(-2)==="MK"?(m=t.skuId.slice(0,-3),y=!0):m=t.skuId,i=o.exists(t.wallartId)?o.proxy(t.wallartId):o.add({id:t.wallartId,owner:s,photo:u,photoDeleted:v,skuId:m,isCC:g,isMK:y,orientation:t.orientation,price:t.price,cropW:t.photo.cropW,cropH:t.photo.cropH,cropX:t.photo.cropX,cropY:t.photo.cropY,isEditable:t.isEditable,isLowQuality:t.isLowQuality,created:t.dateCreate,updated:t.dateUpdate,orders:d,photoSource:t.photoSource}),p.push(i)})),i&&i.stat==="ok"&&e.Array.each(i.books.book,function(t,r){var i,s=!1,o,h;o=a.exists(n.id)?a.proxy(n.id):a.add({id:t.owner}),t.coverPhoto.id?h=e.APIHelper.response.parsePhotos({photos:[t.coverPhoto],personModelRegistry:a,photoModelRegistry:f,photoEngagementModelRegistry:l,photoStatsModelRegistry:c})[0]:s=!0,i=u.exists(t.id)?u.proxy(t.id):u.add({id:t.id,title:t.title,owner:o,coverPhoto:h,coverPhotoDeleted:s,totalPages:t.countPages,created:t.dateCreate,updated:t.dateUpdate,cropW:t.coverPhoto.cropW/100,cropH:t.coverPhoto.cropH/100,cropX:t.coverPhoto.cropX/100,cropY:t.coverPhoto.cropY/100}),d.push(i)}),s.exists(n.id)||s.add({id:n.id,wallarts:p,books:d}),{wallarts:p,books:d}}function r(t,n){var r=this,i=this._processParams(t);return e.Promise.all([n.callAPI("flickr.products.wallart.getList",i,!0),n.callAPI("flickr.products.books.getList",i,!0),n.getModelRegistry("creations-models"),n.getModelRegistry("wallart-models"),n.getModelRegistry("basic-book-models"),n.getModelRegistry("person-models"),n.getModelRegistry("photo-models"),n.getModelRegistry("photo-engagement-models"),n.getModelRegistry("photo-stats-models")]).then(function(e){return r._processResponse(e,t)},function(e){throw n[e.fatal?"error":"debug"]("[flickr-creations-fetcher] failed getting or processing API response:",e),e})}e.namespace("ListFetchers")["flickr-creations"]={run:r,_processParams:t,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["creations-models","wallart-models","basic-book-models","person-models","photo-models","photo-engagement-models","photo-stats-models"]});
YUI.add("creations-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-creations"].run(t,this.appContext)}},removeCreations:function(t,n){var r=this;n.wallarts&&e.Array.each(n.wallarts,function(e,n){r.getValue(t,"wallarts").remove(e)}),n.books&&e.Array.each(n.books,function(e,n){r.getValue(t,"books").remove(e)})},appendCreations:function(t,n){var r=this;n.wallarts&&e.Array.each(n.wallarts,function(e,n){r.getValue(t,"wallarts").unshift(e)})},attributes:{wallarts:{isCollection:!0},books:{isCollection:!0}}})},"@VERSION@",{requires:["flickr-promise","model-proxy","flickr-model-registry","flickr-creations-fetcher"],optional:["wallart-models","basic-book-models"]});
YUI.add("flickr-products-wallart-create-creator",function(e){"use strict";function t(e){var t={};return e=e||{},t.photo_id=e.photoId,t.sku_id=e.skuId,t}function n(e,t,n){var r=e[0],i=e[1],s=e[2],o=e[3],u=t.nsid,a,f,l,c,h=!1,p=!1,d=e[4],v,m;return r?(a=r.wallart,l=s.exists(u)?s.proxy(u):s.add({id:u}),f=o.exists(t.photoId)?o.proxy(t.photoId):o.add({id:t.photoId}),a.skuId.substr(-2)==="CC"?(c=a.skuId.slice(0,-3),h=!0):a.skuId.substr(-2)==="MK"?(c=a.skuId.slice(0,-3),p=!0):c=a.skuId,i.exists(a.wallartId)?(i.setValues(a.wallartId,{owner:l,photo:f,skuId:c,isCC:h,isMK:p,orientation:a.orientation,photoSource:a.photoSource}),m=i.proxy(a.wallartId)):m=i.add({id:a.wallartId,owner:l,photo:f,skuId:c,isCC:h,isMK:p,orientation:a.orientation,created:a.dateCreate,photoSource:a.photoSource}),d.exists(u)&&(v=d.proxy(u),v.appendCreations({wallarts:[i.proxy(a.wallartId)]}))):(n.warn("flickr-products-wallart-create-creator: No API response?"),m=this),m}function r(t,n){var r=this;return e.Promise.all([n.callAPI("flickr.products.wallart.create",this._processParams(t)),n.getModelRegistry("wallart-models"),n.getModelRegistry("person-models"),n.getModelRegistry("photo-models"),n.getModelRegistry("creations-models")]).then(function(e){return r._processResponse(e,t,n)},function(e){throw n.error("[flickr-products-wallart-create-creator] failed getting or processing API response:",e),e})}e.namespace("ModelCreators")["flickr-products-wallart-create"]={run:r,_processParams:t,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","wallart-models"],optional:["person-models","photo-models","creations-models"]});
YUI.add("flickr-products-wallart-editWallart-updater",function(e){"use strict";function t(e,t,n){var r=e.response,i=e.wallartModelRegistry;i.exists(t)&&i.setValue(t,"price",r.wallart.price);if(this.pendingUpdate)return this.pendingUpdate=!1,this.startNextUpdate(t,n)}function n(e,t){return t.getModel("wallart-models",e).then(function(e){var t,n,r,i,s;return n=e.getValue("photo"),i=e.getValue("isCC"),s=e.getValue("isMK"),r=e.getValue("skuId"),i===!0?r+="_CC":s===!0&&(r+="_MK"),t={wallart_id:e.id,photo:{id:n.getValue("id"),owner:n.getValue("owner").getValue("id"),crop_x:e.getValue("cropX"),crop_y:e.getValue("cropY"),crop_h:e.getValue("cropH"),crop_w:e.getValue("cropW")},sku_id:r,orientation:e.getValue("orientation"),is_low_quality:e.getValue("isLowQuality")},{wallart:JSON.stringify(t)}})}function r(t,n){var r=this;return this.serialize(t,n).then(function(i){return(new e.FlickrPromise({response:n.callAPI("flickr.products.wallart.update",i),wallartModelRegistry:n.getModelRegistry("wallart-models")})).then(function(e){return r.processResponse(e,t,n)},function(e){throw r.pendingUpdate&&(r.pendingUpdate=!1),n[e.fatal?"error":"debug"]("[flickr-products-wallart-editWallart-updater] failed getting or processing API response: ",e),e})})}function i(){return this.updateInFlight=null,!0}function s(e,t){return this.updateInFlight=this.callAPI(e,t).then(this.clearUpdateInFlight.bind(this),this.clearUpdateInFlight.bind(this)),this.updateInFlight}function o(e,t){return this.pendingUpdate=null,this.startUpdate(e,t)}function u(e,t){return this.pendingUpdate?this.updateInFlight:this.updateInFlight?(this.pendingUpdate=!0,this.updateInFlight):this.startUpdate(e,t)}e.namespace("ModelUpdaters")["flickr-products-wallart-editWallart"]={run:u,serialize:n,callAPI:r,clearUpdateInFlight:i,startUpdate:s,processResponse:t,startNextUpdate:o}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("wallart-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-products-wallart"].run(t,this.appContext)},create:function(t){return e.ModelCreators["flickr-products-wallart-create"].run(t,this.appContext)},update:function(t,n){return e.ModelUpdaters["flickr-products-wallart-editWallart"].run(t,this.appContext)}},attributes:{owner:{isModel:!0},photo:{isModel:!0},photoDeleted:{defaultFn:function(){return!1}},isCC:{defaultFn:function(){return!1}},isMK:{defaultFn:function(){return!1}},photoSource:{},skuId:{},orientation:{},price:{},cropW:{setter:function(e){return Math.abs(parseFloat(e,10))},defaultFn:function(){return 0}},cropH:{setter:function(e){return Math.abs(parseFloat(e,10))},defaultFn:function(){return 0}},cropX:{setter:function(e){return Math.abs(parseFloat(e,10))},defaultFn:function(){return 0}},cropY:{setter:function(e){return Math.abs(parseFloat(e,10))},defaultFn:function(){return 0}},isLowQuality:{defaultFn:function(){return 0}},isEditable:{defaultFn:function(){return!0}},isDeleted:{defaultFn:function(){return!1}},invalidForPrintReason:{},isInvalidForPrint:{},created:{getter:function(e){return parseInt(e,10)}},updated:{getter:function(e){return parseInt(e,10)}},orders:{}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-products-wallart-fetcher","flickr-products-wallart-create-creator","flickr-products-wallart-editWallart-updater"]});
YUI.add("flickr-products-wallart-fetcher",function(e){"use strict";function t(t){var n={wallart_id:t.id,return_deleted:1,extras:e.APIHelper.request.getRebootPhotoExtras()};return n}function n(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=r.wallart,l,c,h,p,d=!1,v=!1,m={};if(f)return h=s.exists(f.owner)?s.proxy(f.owner):s.add({id:f.owner}),m={photos:[f.photo],personModelRegistry:s,photoModelRegistry:o,photoEngagementModelRegistry:u,photoStatsModelRegistry:a},f.photo.ownerId&&(m.ownerID=f.photo.ownerId),c=e.APIHelper.response.parsePhotos(m)[0],f.skuId.substr(-2)==="CC"?(p=f.skuId.slice(0,-3),d=!0):f.skuId.substr(-2)==="MK"?(p=f.skuId.slice(0,-3),v=!0):p=f.skuId,l={id:f.wallartId,owner:h,photo:c,skuId:p,isCC:d,isMK:v,orientation:f.orientation,price:f.price,cropW:f.photo.cropW,cropH:f.photo.cropH,cropX:f.photo.cropX,cropY:f.photo.cropY,isEditable:f.isEditable,isDeleted:f.isDeleted,isLowQuality:f.isLowQuality,photoSource:f.photoSource,created:f.dateCreate},i.exists(l.id)?i.setValues(l.id,l):i.add(l),l}function r(t,n){var r=this;return e.Promise.all([n.callAPI("flickr.products.wallart.getDetails",this._processParams(t)),n.getModelRegistry("wallart-models"),n.getModelRegistry("person-models"),n.getModelRegistry("photo-models"),n.getModelRegistry("photo-engagement-models"),n.getModelRegistry("photo-stats-models")]).then(function(e){return r._processResponse(e,t)},function(e){throw n[e.fatal?"error":"debug"]("[flickr-products-wallart-fetcher] failed getting or processing API response:",e),e})}e.namespace("ModelFetchers")["flickr-products-wallart"]={run:r,_processResponse:n,_processParams:t}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["wallart-models","photo-models","person-models","photo-engagement-models","photo-stats-models"]});
YUI.add("photo-engagement-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.photoId=e.photoId,this.nsid=e.nsid,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},subviewConfig:{"fave-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,hideWhoFaved:!0},"photo-well-scrappy-edit-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0}},loadState:function(){var e=this;return this.appContext.getModel("photo-models",e.photoId).then(function(t){e.set("photo",t)})},buildContainer:function(){var e,t={viewerIsOwner:this.get("photo").getValue("owner").getValue("isMe"),"photo-well-scrappy-edit-view":this.subviews["photo-well-scrappy-edit-view"].get("container"),"fave-view":this.subviews["fave-view"].get("container"),isVideo:this.get("photo").getValue("isVideo"),canCreateWallart:this.canCreateWallart(),isWallartLowQuality:this.isWallartLowQuality(),photoId:this.get("photo").getValue("id")};return e=this.templates("photo-engagement")(t),this.setContainerHTML(e),t.canCreateWallart&&this.get("container").addClass("has-wallart"),this},buildErrorContainer:function(){this.setContainerHTML("")},activate:function(){var e=this.get("container");return this.downloadMenuSetup(),this.registerEventHandler(e.all(".sizes li a.download-image-size").on("click",this.handleDownloadItemClick,this)),this.attachKeyEvent("down:68",this.handleDownloadMenuButtonClick.bind(this)),this.registerEventHandler(e.delegate("click",this.handleDownloadMenuButtonClick.bind(this),".download a")),this.registerEventHandler(e.delegate("click",this.handleShareClicked.bind(this),".share a")),this.registerEventHandler(e.delegate("click",this.createWallartClick.bind(this),".wallart a")),this.registerEventHandler(this.get("photo").on("valuesChanged",function(e){e.isMarketplacePrintable&&e.isMarketplacePrintable.newVal===!0&&(this.buildContainer(),this.downloadMenuSetup(),this.get("container").all(".sizes li a.download-image-size").on("click",this.handleDownloadItemClick,this))}.bind(this))),this},canCreateWallart:function(){var e=!1,t,n=this.appContext.getViewer(),r,i,s,o,u,a;return this.appContext.flipper.isFlipped("wallart")&&this.appContext.flipper.isFlipped("wallart-on-engagement")&&(t=this.get("photo"),t&&n&&(i=!1,r=t.getValue("owner").getValue("isMe"),s=t.getValue("isMarketplacePrintable"),a=t.getValue("safetyLevel")===0,o=!t.getValue("isVideo"),u=n.intl==="us"||this.appContext.flipper.isFlipped("intl-shipping"),this.appContext.flipper.isFlipped("creative-commons-wallart")?r?this.appContext.getViewer().signedIn&&o&&u&&(e=!0):i?this.appContext.getViewer().signedIn&&o&&u&&a&&(e=!0):s&&this.appContext.getViewer().signedIn&&o&&u&&a&&(e=!0):this.appContext.getViewer().signedIn&&r&&o&&u&&(e=!0))),e},isWallartLowQuality:function(){var t=this.get("photo");return this.wallartHelper||(this.wallartHelper=new e.WallartHelper),this.wallartHelper.isPhotoWallartable(t).skus.length===0?!0:!1},createWallartClick:function(t){var n=this,r="/create/wallart/",i=this.get("photo"),s;t.halt(),e.rapidTracker.beacon(this.name,"createWallartClick");if(i.getValue("hasInvalidColorspaceForPrint"))return this.handleLacksWallartability("COLORSPACE");this.wallartHelper||(this.wallartHelper=new e.WallartHelper(this.appContext));if(this.wallartHelper.isPhotoWallartable(i).skus.length===0)return this.handleLacksWallartability("LOW_QUALITY");this.appContext.getModelRegistry("wallart-models").then(function(t){t.remoteCreate({nsid:n.appContext.getViewer().nsid,photoId:i.getValue("id")}).then(function(t){r+=t.getValue("id")+"/edit",YUI.Env.isServer||(!n.appContext.secure&&window.location.host===e.config.flickr.url.host?e.config.win.location.href=r:n.appContext.flapp.navigate(r))},function(t){s=new e.Views.FluidModal({appContext:n.appContext,darkOverlay:!0,dismissOnOverlayClick:!0,actionButtonLabel:"Okay",title:"Uh oh",message:"There was a problem creating your wall art. Please try again later."}),s.show(),n.appContext.warn("uh oh spaghettios")})})},handleLacksWallartability:function(t){var n,r;t==="LOW_QUALITY"?r="Looks like this photo doesn't meet the minimum requirements to get printed. Please choose a photo that's at least 975 &times; 825 pixels. Learn more about <a href='http://help.yahoo.com/kb/index?page=content&y=PROD_FLICKR&locale=en_US&id=SLN22567'>requirements</a> for print products.":t==="COLORSPACE"&&(r="Sorry, we cannot print photos with a CMYK or ProPhoto RGB colorspace. We recommend photos with an sRGB color space. <a href='https://help.yahoo.com/kb/flickr/creations-faq-sln22216.html?impressions=true#cont33'>Learn more</a>."),n=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,showCancelButton:!1,showCancelX:!0,title:"Try a different photo",message:r,classList:"lacks-wallartability"}),n.show()},handleShareClicked:function(t){t.preventDefault();var n=this,r=this.subviews["share-view"];e.rapidTracker.beacon(this.name,"shareActionBarButtonClick");if(r)return r.fire("subviewViewEvent","openShareMenu",{}),r[r.isVisible()?"hide":"show"]();this.appContext.getView("share-view",{photoId:this._params.photoId,anchorTo:n.get("container").one(".share"),arrow:!0,dropUp:!0,parent:this}).then(function(e){n.subviews["share-view"]=e,e.switchToLoading(),e.initialize().then(function(){e.show()})}).then(null,function(e){n.appContext.warn(e)})},downloadMenuSetup:function(t){var n=this.get("container"),r=e.clone(this.get("photo").toJSON()),i=this,s,o=[],u,a=this.get("photo").getValue("engagement").getValue("canDownload"),f=this.appContext.flipper.isFlipped("download-dialog-enabled"),l=!1;r.sizes.q&&(r.sizes.q.label=this.intlMessage({intlName:"photo-page-scrappy.SQUARE"}),o.push(r.sizes.q)),r.sizes.s&&(r.sizes.s.label=this.intlMessage({intlName:"photo-page-scrappy.SMALL"}),o.push(r.sizes.s)),r.sizes.z&&(r.sizes.z.label=this.intlMessage({intlName:"photo-page-scrappy.MEDIUM"}),o.push(r.sizes.z)),r.sizes.k?(r.sizes.k.label=
this.intlMessage({intlName:"photo-page-scrappy.LARGE"}),o.push(r.sizes.k)):r.sizes.h?(r.sizes.h.label=this.intlMessage({intlName:"photo-page-scrappy.LARGE"}),o.push(r.sizes.h)):r.sizes.l&&(r.sizes.l.label=this.intlMessage({intlName:"photo-page-scrappy.LARGE"}),o.push(r.sizes.l)),r.sizes.o&&(r.sizes.o.label=this.intlMessage({intlName:"photo-page-scrappy.ORIGINAL"}),o.push(r.sizes.o));for(u=0;u<o.length;u++)o[u].url=o[u].displayUrl.replace(/^(.+)(\..+)$/,"$1_d$2");a&&f&&(l=!0),s=this.templates("scrappy-download-menu")({photo:r,sizes:o,showDownloadSizes:l}),this.downloadMenu=e.Views.dialog.getNewInstance("dialog-tooltip",{content:s,anchorTo:n.one(".download"),dropUp:!0,parent:this,positioning:!1,rootEl:n}),this.downloadMenu.render(),this.downloadMenu.on("toggle",function(e){e&&e.details&&e.details.length>0&&(e.details[0]?i.fire("subviewViewEvent","make in view",n):i.fire("subviewViewEvent","close in view"))})},handleDownloadMenuButtonClick:function(t){var n=this.get("photo").getValue("isVideo");e.rapidTracker.beacon(this.name,"downloadDialogClick"),n||(t.preventDefault(),this.downloadMenu.toggle())},handleDownloadItemClick:function(t){t.preventDefault();var n;n=t.currentTarget.getAttribute("href"),document.location=n,e.rapidTracker.beacon(self.name,"photoDownloadClick"),this.downloadMenu.hide()}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-engagement","hermes-template-download-dialog","hermes-template-scrappy-download-menu","wallart-helper","photo-engagement-css"],optional:["photo-models","wallart-models"],langBundles:["common","photo-page-scrappy"]});
YUI.add("hermes-template-photo-page-lightbox",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["photo-well-view"],u):a.call(t,"outlet",t["photo-well-view"],u)))+"\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-page-lightbox",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-well",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){return" no-click"}function d(e,t){return" is-hidden"}function v(e,t){return" is-video"}function m(e,t){var r;return(r=n["prev-url"])?r=r.call(e,{hash:{},data:t}):(r=e["prev-url"],r=typeof r===f?r.apply(e):r),l(r)}function g(e,t){return"#"}function y(e,t){var r;return(r=n["next-url"])?r=r.call(e,{hash:{},data:t}):(r=e["next-url"],r=typeof r===f?r.apply(e):r),l(r)}function b(e,t){var r="",i,s;r+="\n	",i=n["if"].call(e,e["opt-out-enabled"],{hash:{},inverse:c.noop,fn:c.program(14,w,t),data:t});if(i||i===0)r+=i;return r+="\n\n",s={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["photo-sidebar-toggle-view"],s):h.call(e,"outlet",e["photo-sidebar-toggle-view"],s)))+"\n",s={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["photo-title-desc-overlay-view"],s):h.call(e,"outlet",e["photo-title-desc-overlay-view"],s)))+"\n",s={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["photo-sidebar-actions-view"],s):h.call(e,"outlet",e["photo-sidebar-actions-view"],s)))+"\n",s={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["attribution-view"],s):h.call(e,"outlet",e["attribution-view"],s)))+"\n",s={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["people-notes-view"],s):h.call(e,"outlet",e["people-notes-view"],s)))+"\n\n",r}function w(e,t){return'\n	<div class="feedback-widget">\n		<button class="ui-button ui-button-cta ui-button-transparent"><span>Opt-out &amp; Feedback</span></button>\n	</div>\n	'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<a class="navigate-target navigate-prev',o=n["if"].call(t,t["prev-is-not-clickable"],{hash:{},inverse:c.noop,fn:c.program(1,p,i),data:i});if(o||o===0)s+=o;o=n["if"].call(t,t["is-hidden"],{hash:{},inverse:c.noop,fn:c.program(3,d,i),data:i});if(o||o===0)s+=o;o=n["if"].call(t,t["is-video"],{hash:{},inverse:c.noop,fn:c.program(5,v,i),data:i});if(o||o===0)s+=o;s+='" href="',o=n["if"].call(t,t["prev-url"],{hash:{},inverse:c.program(9,g,i),fn:c.program(7,m,i),data:i});if(o||o===0)s+=o;s+='" data-track="prevPhotoButtonClick" data-action="ad"><span class="hide-text">&rarr;</span></a>\n<a class="navigate-target-arrow-only navigate-target navigate-prev',o=n["if"].call(t,t["prev-is-not-clickable"],{hash:{},inverse:c.noop,fn:c.program(1,p,i),data:i});if(o||o===0)s+=o;o=n["if"].call(t,t["is-hidden"],{hash:{},inverse:c.noop,fn:c.program(3,d,i),data:i});if(o||o===0)s+=o;o=n["if"].call(t,t["is-video"],{hash:{},inverse:c.noop,fn:c.program(5,v,i),data:i});if(o||o===0)s+=o;s+='" href="',o=n["if"].call(t,t["prev-url"],{hash:{},inverse:c.program(9,g,i),fn:c.program(7,m,i),data:i});if(o||o===0)s+=o;s+='" data-track="prevPhotoButtonClick" data-action="ad"><span class="hide-text">&larr;</span></a>\n\n',a={hash:{},data:i},s+=l((o=n.outlet||t.outlet,o?o.call(t,t["photo-well-media-view"],a):h.call(t,"outlet",t["photo-well-media-view"],a)))+'\n\n<a class="navigate-target navigate-next',u=n["if"].call(t,t["next-is-not-clickable"],{hash:{},inverse:c.noop,fn:c.program(1,p,i),data:i});if(u||u===0)s+=u;u=n["if"].call(t,t["is-hidden"],{hash:{},inverse:c.noop,fn:c.program(3,d,i),data:i});if(u||u===0)s+=u;u=n["if"].call(t,t["is-video"],{hash:{},inverse:c.noop,fn:c.program(5,v,i),data:i});if(u||u===0)s+=u;s+='" href="',u=n["if"].call(t,t["next-url"],{hash:{},inverse:c.program(9,g,i),fn:c.program(11,y,i),data:i});if(u||u===0)s+=u;s+='" data-track="nextPhotoButtonClick" data-action="ad"><span class="hide-text">&rarr;</span></a>\n<a class="navigate-target-arrow-only navigate-target navigate-next',u=n["if"].call(t,t["next-is-not-clickable"],{hash:{},inverse:c.noop,fn:c.program(1,p,i),data:i});if(u||u===0)s+=u;u=n["if"].call(t,t["is-hidden"],{hash:{},inverse:c.noop,fn:c.program(3,d,i),data:i});if(u||u===0)s+=u;u=n["if"].call(t,t["is-video"],{hash:{},inverse:c.noop,fn:c.program(5,v,i),data:i});if(u||u===0)s+=u;s+='" href="',u=n["if"].call(t,t["next-url"],{hash:{},inverse:c.program(9,g,i),fn:c.program(11,y,i),data:i});if(u||u===0)s+=u;s+='" data-track="nextPhotoButtonClick" data-action="ad"><span class="hide-text">&rarr;</span></a>\n\n',u=n.unless.call(t,t["is-ad"],{hash:{},inverse:c.noop,fn:c.program(13,b,i),data:i});if(u||u===0)s+=u;return s+="\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-well",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-reboot-welcome-dialog-content",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function a(e,t){return"\n	While we continue to develop the beta experience, we want your feedback. In case you need some of the missing functionality, you can easily opt-out and go back to the old experience.\n"}function f(e,t){return"\n	Please continue providing us with feedback so we can continue to improve Flickr.\n"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this;s+="Flickr is about the amazing photos you capture and the communities that you build around these photos. The goal of our photo page redesign is to provide you with a fast photo browsing experience and an easy interface to build &amp; maintain relationships.<br>\n<br>\nOver the last 4 weeks, we received a lot of feedback from the Flickr community regarding the photo page design. Based on the feedback, we are experimenting with different variations of the photo page to identify the best experience.<br>\n<br>\n",o=n["if"].call(t,t["opt-out-enabled"],{hash:{},inverse:u.program(3,f,i),fn:u.program(1,a,i),data:i});if(o||o===0)s+=o;return s+="\n<br>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/reboot-welcome-dialog-content",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-opt-out",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<form action="//',(o=n.host)?o=o.call(t,{hash:{},data:i}):(o=t.host,o=typeof o===u?o.apply(t):o),s+=a(o)+'/help/optin" method="post">\n	<input type="hidden" name="photo_opt" value="0">\n	<input type="hidden" name="redirect_url" value="',(o=n["redirect-url"])?o=o.call(t,{hash:{},data:i}):(o=t["redirect-url"],o=typeof o===u?o.apply(t):o),s+=a(o)+'">\n	<input type="submit" class="ui-button" value="Go back to the old experience">\n</form>',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-opt-out",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-well-media",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function c(e,t){var r="",i,s,o;r+='\n	<div class="restricted-interstitial">\n		<div class="restricted-interstitial-message">\n			<h2>',o={hash:{intlName:"photo-page-scrappy.ADULT_CONTENT"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,o):u.call(e,"intlMessage",o)))+"</h2>\n			",s=n["if"].call(e,e.isSignedIn,{hash:{},inverse:l.program(4,p,t),fn:l.program(2,h,t),data:t});if(s||s===0)r+=s;return r+="\n		</div>\n	</div>\n",r}function h(e,t){var r="",i,s;return r+="\n				<p>",s={hash:{intlName:"photo-page-scrappy.MATURE_AUDIENCES"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+"<br />",s={hash:{intlName:"photo-page-scrappy.USER_DISCRETION"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+"</p>\n				<p><button class='ui-button'><span>",s={hash:{intlName:"photo-page-scrappy.SHOW_ME_THIS_CONTENT_TYPE"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+"</span></button></p>\n				<p>",s={hash:{intlName:"photo-page-scrappy.CHANGE_SAFE_SEARCH_IN_SETTINGS"},data:t},r+=a((i=n.intlHTMLMessage||e.intlHTMLMessage,i?i.call(e,s):u.call(e,"intlHTMLMessage",s)))+"</p>\n			",r}function p(e,t){var r="",i,s,o;return r+="\n				<p>",o={hash:{intlName:"photo-page-scrappy.SIGNED_IN_FOR_CONTENT"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,o):u.call(e,"intlMessage",o)))+' <a href="//',(s=n.host)?s=s.call(e,{hash:{},data:t}):(s=e.host,s=typeof s===f?s.apply(e):s),r+=a(s)+'/signin/" data-track="photoWellSignInClick">',o={hash:{intlName:"common.SIGN_IN"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,o):u.call(e,"intlMessage",o)))+"</a></p>\n			",r}function d(e,t){var r="",i;r+="\n\n	",i=n["if"].call(e,e.isAd,{hash:{},inverse:l.noop,fn:l.program(7,v,t),data:t});if(i||i===0)r+=i;r+="\n		",i=n["if"].call(e,e.isVideo,{hash:{},inverse:l.program(11,g,t),fn:l.program(9,m,t),data:t});if(i||i===0)r+=i;r+="\n	",i=n["if"].call(e,e.isAd,{hash:{},inverse:l.noop,fn:l.program(14,b,t),data:t});if(i||i===0)r+=i;return r+="\n",r}function v(e,t){var n="",r;return n+='\n		<a class="ad-wrapper" href="'+a((r=(r=e.ad,r==null||r===!1?r:r.clickUrl),typeof r===f?r.apply(e):r))+'">\n	',n}function m(e,t){var r="",i;return r+='\n			<div class="videoplayer main-photo" style="width:',(i=n.width)?i=i.call(e,{hash:{},data:t}):(i=e.width,i=typeof i===f?i.apply(e):i),r+=a(i)+"px; height:",(i=n.height)?i=i.call(e,{hash:{},data:t}):(i=e.height,i=typeof i===f?i.apply(e):i),r+=a(i)+'px;"></div>\n		',r}function g(e,t){var r="",i,s,o;r+='\n\n			<div class="facade-of-protection-neue ',i=n["if"].call(e,e["is-video"],{hash:{},inverse:l.noop,fn:l.program(12,y,t),data:t});if(i||i===0)r+=i;return r+='">\n				',o={hash:{},data:t},r+=a((i=n.outlet||e.outlet,i?i.call(e,e["zoom-view"],o):u.call(e,"outlet",e["zoom-view"],o)))+'\n			</div>\n\n			<img width="',(s=n.width)?s=s.call(e,{hash:{},data:t}):(s=e.width,s=typeof s===f?s.apply(e):s),r+=a(s)+'" height="',(s=n.height)?s=s.call(e,{hash:{},data:t}):(s=e.height,s=typeof s===f?s.apply(e):s),r+=a(s)+'" src="',(s=n.src)?s=s.call(e,{hash:{},data:t}):(s=e.src,s=typeof s===f?s.apply(e):s),r+=a(s)+'" class="low-res-photo">\n			<img width="',(s=n.width)?s=s.call(e,{hash:{},data:t}):(s=e.width,s=typeof s===f?s.apply(e):s),r+=a(s)+'" height="',(s=n.height)?s=s.call(e,{hash:{},data:t}):(s=e.height,s=typeof s===f?s.apply(e):s),r+=a(s)+'" src="',(s=n.highResSrc)?s=s.call(e,{hash:{},data:t}):(s=e.highResSrc,s=typeof s===f?s.apply(e):s),r+=a(s)+'" class="main-photo is-hidden" onload="registerFirstPhoto(this)">\n			<noscript>\n				<img width="',(s=n.width)?s=s.call(e,{hash:{},data:t}):(s=e.width,s=typeof s===f?s.apply(e):s),r+=a(s)+'" height="',(s=n.height)?s=s.call(e,{hash:{},data:t}):(s=e.height,s=typeof s===f?s.apply(e):s),r+=a(s)+'" src="',(s=n.highResSrc)?s=s.call(e,{hash:{},data:t}):(s=e.highResSrc,s=typeof s===f?s.apply(e):s),r+=a(s)+'" class="main-photo">\n			</noscript>\n		',r}function y(e,t){return"is-video"}function b(e,t){var r="",i,s;return r+='\n			<span class="ad-info">',s={hash:{intlName:"photo-page-scrappy.FIND_OUT_MORE_AD",brand:(i=e.ad,i==null||i===!1?i:i.brand)},data:t},r+=a((i=n.intlHTMLMessage||e.intlHTMLMessage,i?i.call(e,s):u.call(e,"intlHTMLMessage",s)))+"</span>\n		</a>\n	",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=n.helperMissing,a=this.escapeExpression,f="function",l=this;o=n["if"].call(t,t.needsInterstitial,{hash:{},inverse:l.program(6,d,i),fn:l.program(1,c,i),data:i});if(o||o===0)s+=o;return s+="\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-well-media",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("photo-well-media-view",function(e){var t=500,n=500,r=100,i;i={photo:{render:function(){var t=this,n,i=this.get("photo"),s,o,u=new Date;return t.preloadImage&&(t.preloadImage.onload=null),s=this.getPhotoForDisplay(),o=this.getPhotoForDisplay({includeSizes:["sq","q","t","s","n"]}),n=this.templates("photo-well-media")({width:s.width,height:s.height,src:o.url,highResSrc:s.url,needsInterstitial:i.getValue("needsInterstitial"),isSignedIn:this.appContext.getViewer().signedIn,isVideo:i.getValue("isVideo"),isAd:this.isAd,"zoom-view":this.subviews["zoom-view"]?this.subviews["zoom-view"].get("container"):""}),this.setContainerHTML(n),this.fire("subviewViewEvent",s),YUI.Env.isServer?(this.serverWidth=s.width,this.serverHeight=s.height):i.getValue("needsInterstitial")||(t.preloadImage=new Image,t.preloadImage.onload=function(){if(this.onloadFired)return;if(!t.isActiveAndInDOM())return;this.onloadFired=!0,e.rapidTracker.beacon(this.name,"photoPageShowedSize"+(/(?:_([a-z]))?\.jpg/.exec(s.url)[1]||"\u00f8").toUpperCase());var n=t.get("container").one(".low-res-photo"),i=t.get("container").one(".main-photo"),o=new Date-u,a;o<r?(i.removeClass("is-hidden").show(),n.hide()):(i.setStyles({position:"absolute",left:0,top:0,opacity:0}),i.removeClass("is-hidden"),a=function(){i.removeAttribute("style"),n.hide()},e.UA.ie?a():e.use("transition",function(e){i.transition({duration:.25,opacity:1},a)}))},t.preloadImage.src=s.url,t.preloadImage.complete&&t.preloadImage.onload()),this}},video:{render:function(){var t,n=this,r=this.get("photo"),i=this.getPhotoForDisplay({excludeSizes:[]});return this.player?(this.player.resize(i.width,i.height),this):(t=this.templates("photo-well-media")({width:i.width,height:i.height,src:i.url,needsInterstitial:r.getValue("needsInterstitial"),isVideo:r.getValue("isVideo"),isSignedIn:this.appContext.getViewer().signedIn,"zoom-view":""}),this.setContainerHTML(t),this.fire("subviewViewEvent",i),YUI.Env.isServer?this:(this.player=new e.FlickrVideoPlayer({container:this.get("container").one(".videoplayer"),model:r,appContext:this.appContext}),n.player.init().then(function(){n}),this.on("destroy",function(){n.player.destroy(),n.player=null}),this))}},yepVideoDisabled:{render:function(){var e,t=this.get("photo"),n=this.getPhotoForDisplay();return e=this.templates("photo-well-media-novideo")({width:n.width,height:n.height,src:n.url,needsInterstitial:t.getValue("needsInterstitial"),isVideo:t.getValue("isVideo")}),this.setContainerHTML(e),this}},ad:{render:function(){var e,t,n;return this.adJSON?t=this.adJSON:(t=this.appContext.adManager.getAdJSON(),this.adJSON=t),n=this.getAdSize(t),e=this.templates("photo-well-ad")({width:n.width,height:n.height,src:t.url,clickUrl:t.clickUrl,brand:t.brand,adsTypeB:this.appContext.flipper.isFlipped("moneyball-ads-type-b")}),this.setContainerHTML(e),this}}},e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{"zoom-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(){return!this.appContext.flipper.isFlipped("enable-scrappy-zoom")},disableIfSmall:!0}},initializer:function(e){return this.photoId=e.photoId,this.isAd=!!e.ad,this.ad=e.ad,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},loadState:function(){var e=this;return this.appContext.getModel("photo-models",e.photoId).then(function(t){e.set("photo",t)})},buildContainer:function(){return YUI.Env.isServer||this.set("clientRendered",!0),this.isAd?i.ad.render.call(this):this.appContext.flipper.isFlipped("yep-video")?i[this.get("photo").getValue("isVideo")?"video":"photo"].render.call(this):i.yepVideoDisabled.render.call(this),this},handleInterstitialDismissButtonClick:function(t){var n=this,r=this.get("personPreferences"),i=this.get("photo"),s=i.getValue("safetyLevel");e.rapidTracker.beacon(this.name,"restrictedContentInterstitialClick"),r.setValue("safeSearch",s),r.registry.remoteUpdate(n.appContext.auth.user.nsid).then(function(e){var t=i.registry.attributeSearch({needsInterstitial:!0});t.forEach(function(e){i.registry.getValue(e,"safetyLevel")<=r.getValue("safeSearch")&&i.registry.setValue(e,"needsInterstitial",!1)}),n.buildContainer()},function(e){n.appContext.error(e.message),n.appContext.error(e.stack),n.onError(n.intlMessage({intlName:"photo-page-scrappy.COULDNT_UPDATE_SETTINGS"}))})},activate:function(){var t=this,n=this.getPhotoForDisplay(),r=this.get("container").one(".main-photo"),i,s;return this.get("photo").getValue("needsInterstitial")||(e.use("global-events",function(e){t.registerEventHandler(e.globalEvents.subscribe("window:resize",function(e){t.set("canvasSizeIsDirty",!0),t.buildContainer()}))}),this.registerEventHandler(e.on("flickr:photo-media-well-update",function(e){t.set("canvasSizeIsDirty",!0),t.buildContainer()})),!this.isAd&&(!t.get("clientRendered")||n.width!==Number(r.getAttribute("width"))||n.height!==Number(r.getAttribute("height")))&&t.buildContainer()),this.registerEventHandler(e.on("flickr:display-note-box",function(n){i=e.Node.create('<div class="note-box"></div>'),s=t.get("container").one(".main-photo").getXY(),t.get("container").append(i),i.setStyles({top:n.noteBoxTop+t.get("container").one(".main-photo").getDOMNode().offsetTop,left:n.noteBoxLeft,width:n.noteBoxWidth,height:n.noteBoxHeight})})),this.appContext.getViewer().signedIn&&this.appContext.getModel("person-preferences-models",t.appContext.auth.user.nsid).then(function(e){t.set("personPreferences",e),t.get("photo").getValue("needsInterstitial")&&t.registerEventHandler(t.get("container").one(".restricted-interstitial-message button").on("click",t.handleInterstitialDismissButtonClick,t))}),this},onError:function(t){var n=this;this.fire("subviewViewEvent","getDialogOffset",function(r){var i=e.Views.dialog.getInstance("dialog-alert",{content:t,attrs:{title:n.intlMessage({intlName:"common.ERROR"}),level:"warning",confirmLabel:n.intlMessage({intlName:"common.OK"})},parent:n,offsetLeft:r});i.show()})},getPhotoForDisplay:function(
e){var t=this.getCanvasSize(),n=this.getPixelRatio(),r=this.get("photo").getSizeToFit(t,e),i,s;return i=Math.min(t.height/n,r.height),s=Math.min(t.width/n,r.width/r.height*i),i=Math.min(i,r.height/r.width*s),{width:Math.round(s),height:Math.round(i),url:r.url,pixelRatio:r.width/s}},getAdSize:function(e){var t=this.getCanvasSize(),n=this.getPixelRatio(),r=80,i=140,s,o;return this.appContext.flipper.isFlipped("moneyball-ads-type-b")&&(t.height-=(r+i)*n,t.width-=i*n),s=Math.min(t.height/n,e.height),o=Math.min(t.width/n,e.width/e.height*s),s=Math.min(s,e.height/e.width*o),{width:o,height:s}},getCanvasSize:function(){var e,r=this.getPixelRatio(),i;return this.get("canvasSizeIsDirty")?YUI.Env.isServer||(i=this.get("container").ancestor(),i&&(e=i.get("region"),e.width>0&&e.height>0&&(this.set("canvasSizeIsDirty",!1),this.set("cachedCanvasSize",e),this.appContext.setCookie({remove:!0,cookieName:"photoPW",path:"/photos/",cookieValue:e.width}),this.appContext.setCookie({remove:!0,cookieName:"photoPH",path:"/photos/",cookieValue:e.height}),this.appContext.setCookie({remove:!0,cookieName:"density",path:"/photos/",cookieValue:r})))):e=this.get("cachedCanvasSize"),e||(e={top:0,left:0,bottom:n,right:t,width:parseInt(this.appContext.getCookie("photoPW"),10)||t,height:parseInt(this.appContext.getCookie("photoPH"),10)||n}),e.height*=r,e.width*=r,e},getPixelRatio:function(){return this.appContext.getViewer().getPixelRatio()}},{ATTRS:{canvasSizeIsDirty:{value:!0,setter:function(e){return!!e}},cachedCanvasSize:{getter:function(t){return e.merge(t)},setter:function(t){return e.merge(t)}}}})},"@VERSION@",{requires:["flog","flickr-view","hermes-template-photo-well-media","hermes-template-photo-well-media-novideo","moment","flickr-video-player","hermes-template-photo-well-ad","zoom-view"],optional:["photo-models"],langBundles:["common","photo-page-scrappy"]});
